version: 2.1
  
jobs:
  create-eks-cluster:
    docker:
      - image: swheat320/docker-node-py-tf:1.0
    steps:
      - checkout
      - run: 
          name: Deploy EKS via terraform
          command: |
            cd terraform
            terraform --version
            terraform init -reconfigure
            terraform validate
            terraform plan -out "planfile"
            terraform apply -input=false "planfile"

workflows:
  deployment:
    jobs:
      - create-eks-cluster
      